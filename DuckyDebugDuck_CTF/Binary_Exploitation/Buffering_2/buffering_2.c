#include <stdio.h>
#include <unistd.h>
#include <string.h>
#include "flag.h"

int get_credentials();
int authenticate_with_server(int *authenticated);
void print_flag();

extern char flag[100];
char debug_buffer[100] = {0};
char spinning_icon[4] = {'/', '-', '\\', '|'};

#define USERNAME_LENGTH 32
#define PASSWORD_LENGTH 64


int main() {
    int authenticated = 0;
    long int i = 0;

    printf("Hello and thank you for using Flag Distibuter v2.1 ðŸš©ðŸš©ðŸš©\n");
	get_credentials();
    
    printf("Autenticating  ");
    while (!authenticate_with_server(&authenticated)) {
        printf("\b%c", spinning_icon[(i++) % 4]);
        fflush(stdout);
        sleep(0.91);
    }

    if(authenticated)
        print_flag();
	
    return 0;
}

int get_credentials() {
	char username[USERNAME_LENGTH] = {0};
    char password[PASSWORD_LENGTH] = {0};

    printf("To receive the flag, please enter your username and password\n");
    printf("Username: ");
    fflush(stdout);
	read(STDIN_FILENO, username, PASSWORD_LENGTH);
    printf("Password: ");
    fflush(stdout);
    read(STDIN_FILENO, password, PASSWORD_LENGTH);
}

void print_flag() {
	printf("This service is in maintenance, please try again later\n");
}

int authenticate_with_server(int *authenticated) {
    /*TODO: add authentication with server*/
    return 0;
}
